<!DOCTYPE html>
<html>

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css">
	<link rel="stylesheet" href="./style.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@800&display=swap" rel="stylesheet">
	<title>Dev</title>
	<style>
		.container {
			width: 480px;
		}

		.card {
			width: 200px;
			background-color:whitesmoke;
			box-shadow: 0px 0px 10px lightgrey;
			border: 0px;
			border-radius: 0px;
		}

		.card-body {
			width: inherit;
		}

		.card-img-top {
			width: 200px;
		}		
	</style>
</head>
<body>
	<div class="container">
    <nav>
		<div class="nav nav-tabs" id="nav-tab" role="tablist">
		  <button class="nav-link active" id="nav-group1-tab" data-bs-toggle="tab" data-bs-target="#group1" type="button" role="tab" aria-controls="nav-home" aria-selected="true">group1</button>
		</div>
	</nav>

	
	<div class="tab-content" id="nav-tabContent">
		<div class="tab-pane fade show active" id="group1" role="tabpanel" aria-labelledby="nav-home-tab">
			<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
				<li class="nav-item" role="presentation">
				  <button class="nav-link active" id="pills-all-tab" data-bs-toggle="pill" data-bs-target="#pills-group1-all" type="button" role="tab" aria-controls="pills-group1-all" aria-selected="true">All</button>
				</li>
				<li class="nav-item" role="presentation">
				  <button class="nav-link" id="pills-images-tab" data-bs-toggle="pill" data-bs-target="#pills-group1-images" type="button" role="tab" aria-controls="pills-group1-images" aria-selected="false"><i class="bi bi-images"></i>&nbsp;&nbsp;Images</button>
				</li>
				<li class="nav-item" role="presentation">
				  <button class="nav-link" id="pills-files-tab" data-bs-toggle="pill" data-bs-target="#pills-group1-files" type="button" role="tab" aria-controls="pills-group1-files" aria-selected="false"><i class="bi bi-files"></i>&nbsp;&nbsp;Files</button>
				</li>
				<li class="nav-item" role="presentation">
				  <button class="nav-link" id="pills-url-tab" data-bs-toggle="pill" data-bs-target="#pills-group1-url" type="button" role="tab" aria-controls="pills-group1-url" aria-selected="false"><i class="bi bi-link"></i>&nbsp;&nbsp;URL</button>
				</li>
			</ul>

			<div class="tab-content" id="pills-tabContent">
				<div class="tab-pane fade show active" id="pills-group1-all" role="tabpanel" aria-labelledby="pills-all-tab">
					<div class = "tilecontainer d-flex align-self-start flex-wrap" id="alltiles">
						
					</div>
				</div>
				<div class="tab-pane fade" id="pills-group1-images" role="tabpanel" aria-labelledby="pills-images-tab">
					<div class = "tilecontainer d-flex align-self-start flex-wrap" id="imagetiles">
						
					</div>
				</div>
				<div class="tab-pane fade" id="pills-group1-files" role="tabpanel" aria-labelledby="pills-files-tab">
					<div class = "tilecontainer d-flex align-self-start flex-wrap" id="filetiles">
						
					</div>
				</div>
				<div class="tab-pane fade" id="pills-group1-url" role="tabpanel" aria-labelledby="pills-url-tab">
					<div class = "tilecontainer d-flex align-self-start flex-wrap" id="urltiles">
						
					</div>
				</div>
			</div>
		</div>
		<button type="button" class="btn" id="addentrybutton" style="background-color:orange; font-size:small; font-weight:bolder; color: white; border-radius: 30px;">+</button>
		<button type="button" class="btn" id="addthispagebutton" style="background-color:orange; font-size: small; font-weight:bolder; color: white; border-radius: 30px;">Add this page</button>
	</div>	
	
	

	<input type="file" id="fileinput" style="display:none;">
</body>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js" integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk" crossorigin="anonymous"></script>
<script>
	let entries=[];

	const TileType = {
		Temp: 0, // Confirm tile before uploading
		Image : 1,
		File : 2,
		URL : 3,
	};

	const FileType = {
		Image : 1,
		File : 2,
		URL : 3
	}

	function addEntry(entry) {
		entries.push(entry);

		let card = createCard(entry);
		let tilecontainer = document.querySelector("#alltiles");
		tilecontainer.appendChild(card);

		if(entry.filetype == FileType.Image) {
			tilecontainer = document.querySelector("#imagetiles");
			let dupcard = card.cloneNode(true);
			tilecontainer.appendChild(dupcard); // to do : need to append tile to the html
		}
		if(entry.filetype == FileType.File) {
			tilecontainer = document.querySelector("#filetiles");
			let dupcard = card.cloneNode(true);
			tilecontainer.appendChild(dupcard); // to do : need to append tile to the html
		}
		if(entry.filetype == FileType.URL) {
			tilecontainer = document.querySelector("#urltiles");
			let dupcard = card.cloneNode(true);
			tilecontainer.appendChild(dupcard); // to do : need to append tile to the html
		}		
	}

	function createCard(entry) {
		let card = document.createElement("div");
		card.className = "card";
		
		let img = document.createElement("img");
		img.class = "card-img-top";
		img.src = entry.file;
		console.log(entry);
		if(entry.filetype === FileType.Image)
			card.appendChild(img);

		let cardbody = document.createElement("div");
		cardbody.className = "card-body";
		card.appendChild(cardbody);

		let title = document.createElement("h6");
		title.className = "card-title";
		let titletext = document.createTextNode(entry.filename);
		title.appendChild(titletext);
		cardbody.appendChild(title);

		let desc = document.createElement("h7");
		desc.className = "card-text";
		let desctext = document.createTextNode(entry.desc);
		desc.appendChild(desctext);
		cardbody.appendChild(desc);

		return card;
	}

	function uploadServer(entry) {

	}

	let addentrybutton = document.querySelector("#addentrybutton");
	let addthispagebutton = document.querySelector("#addthispagebutton");

	addentrybutton.addEventListener("click", () => {
		document.querySelector("#fileinput").click();
	});

	let fileinput = document.querySelector("#fileinput");
	fileinput.addEventListener("change", (event) => {
		let file = event.target.files[0];
		let tok = file.name.lastIndexOf(".");
		let filetype = file.name.substring(tok + 1, file.length).toLowerCase();

		switch(filetype) {
			case '': 
				filetype = FileType.File;
				break;
			case 'jpg':
			case 'png':
			case 'gif':
			case 'jpeg':
				filetype = FileType.Image;
				break;
			default:
				filetype = FileType.File;
		}

		let filereader = new FileReader();
		filereader.readAsDataURL(file);

		filereader.onload = function() {
 			let entry = {
				// defines tile viewing option
				tiletype: TileType.Temp,
			
				// file metadata
				file: filereader.result,
				filename: file.name,
				filetype: filetype,
				date: '', 

				// user information
				user: '',
				desc: '',
			}
			addEntry(entry);
		}
		// to do : view input tile, add event listner to them to upload, cancel, ... 
	});

	addthispagebutton.addEventListener("click", () => {
		let url = window.location.href;
		let entry = {
			tiletype: TileType.Temp,

			file: url,
			filename: document.title,
			filetype: FileType.URL,
			date: '',

			user: '',
			desc: ''
		}

		addEntry(entry);
	});
</script>